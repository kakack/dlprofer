<!-- !@file base.html
 *
 * Copyright (c) 2021, NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA CORPORATION and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA CORPORATION is strictly prohibited.
-->

{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>DLProf</title>

    <script src="{% static 'dlprof/Aggregation.js' %}"></script>
    <script src="{% static 'dlprof/AppVersion.js' %}"></script>
    <script src="{% static 'dlprof/DLprofFunctions.js' %}"></script>
    <script src="{% static 'dlprof/chevrons.js' %}"></script>
    <script src="{% static 'dlprof/ViewDroplist.js' %}"></script>
    <script src="{% static 'dlprof/AggregationDroplist.js' %}"></script>
    <script src="{% static 'dlprof/DomainDroplist.js' %}"></script>
    <script src="{% static 'dlprof/Navbar.js' %}"></script>
    <script src="{% static 'dlprof/PerformanceSummaryPanel.js' %}"></script>

    <link
      rel="stylesheet"
      type="text/css"
      href="https://stackpath.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://stackpath.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.35.4/css/bootstrap-dialog.min.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'dlprof/dlprof.css' %}"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://unpkg.com/treetables@1.2.1/tree-table.min.css"
    />
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-3.3.1.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.1.1/chartjs-plugin-zoom.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/plug-ins/1.10.21/api/row().show().js"
    ></script>
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.min.css"
    />
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.35.4/js/bootstrap-dialog.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/treetables@1.2.1/treeTable.js"
    ></script>
    <link
      rel="icon"
      type="image/png"
      href="{% static 'dlprof/faviconMini.ico' %}"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js"></script>
  </head>

  <body>
    <nav id="dlprofNavbar" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <img src="{% static 'dlprof/favicon.ico' %}" height="50px" style="float: left" />

        <div id="navigatorTableMenuGap" class="navbar-header">
          <a class="navbar-brand" href="dashboard.html">
            &nbsp; Biren DLProf Viewer</a
          >
        </div>

        <ul class="nav navbar-nav navbar-left">
          <div class="dlprof-navbar">
            <table>
              <tbody>
                <tr>
                  <td class="navigatorTableLabel viewSelectionRow">View</td>
                  <td class="navigatorTableDropList viewSelectionRow">
                    <span class="dropdown">
                      <button
                        class="btn btn-primary dropdown-toggle"
                        id="launchViewEvent"
                        type="button"
                        data-toggle="dropdown"
                      >
                        <span class="caret"></span>
                      </button>
                      <ul id="launchViewList" class="dropdown-menu"></ul>
                    </span>
                  </td>
                  <td>
                    <button 
                      class="btn copy-btn btn-primary"
                      style="margin-left: 8px;"
                    >
                    Tracing Trace log
                    </button>
                  </td> 
                  <td
                    class="navigatorTableLabel aggregationSelectionRow"
                    style="display: none"
                  >
                    Aggregation
                  </td>
                  <td
                    class="navigatorTableDropList aggregationSelectionRow"
                    style="display: none"
                  >
                    <span class="dropdown">
                      <button
                        class="btn btn-primary dropdown-toggle"
                        id="aggregationDroplist"
                        type="button"
                        data-toggle="dropdown"
                      >
                        <span class="caret"></span>
                      </button>

                      <!-- Following is filled with aggregations from coreDB -->
                      <ul id="launchAggregationList" class="dropdown-menu"></ul>
                    </span>
                  </td>
                  

                  <td
                    class="navigatorTableLabel domainSelectionRow"
                    style="display: none"
                  >
                    Domain
                  </td>
                  <td
                    class="navigatorTableDropList domainSelectionRow"
                    style="display: none"
                  >
                    <span class="dropdown">
                      <button
                        class="btn btn-primary dropdown-toggle"
                        id="domainDroplist"
                        type="button"
                        data-toggle="dropdown"
                      >
                        <span class="caret"></span>
                      </button>

                      <!-- Following is filled with domains from core DB -->
                      <ul id="launchDomainList" class="dropdown-menu"></ul>
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </ul>

        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown messages-dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown"
              ><i class="fa fa-question-circle-o"></i> Help <b class="caret"></b
            ></a>

            <ul class="dropdown-menu">
              <li>
                <a
                  href="https://docs.nvidia.com/deeplearning/frameworks/dlprof-user-guide/index.html"
                  ><i class="fa fa-file-text-o"></i> Deep Learning Profiler</a
                >
              </li>
              <li>
                <a
                  href="https://docs.nvidia.com/deeplearning/frameworks/dlprof-viewer-user-guide/index.html"
                  ><i class="fa fa-file-text-o"></i> DLProf Viewer</a
                >
              </li>
              <li role="separator" class="divider"></li>
              <li>
                <a href="mailto:dlprof-feedback@nvidia.com"
                  ><i class="fa fa-send-o"></i> Contact Us</a
                >
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>

    <div
      id="invalid-url-arguments-panel"
      class="alert alert-danger alignCenter"
      style="display: none"
    ></div>

    <div
      id="reaggregate-inprogress-panel"
      class="alert alert-info alignCenter"
      style="display: none"
    >
      <strong>Underway!</strong> Your network is now being reaggregated. This
      may take several minutes....
    </div>

    <div
      id="reaggregate-finished-panel"
      class="alert alert-success alignCenter"
      style="display: none"
    >
      <strong>Success!</strong> Your network has been reaggregated. Click
      REFRESH on your browser to see new data.
    </div>

    <div
      id="illegal-database-panel"
      class="alert alert-danger alignCenter alignLeft"
      style="display: none"
    >
      <strong>Oh no!</strong> The database file does not contain a legal
      configuration.
      <br />
      <br />
      <u>What does this mean?</u> The database was likely initialized via the
      DLPROF_init() API, but no aggregations were added.<br />
      <u>What can I do?</u> Call the DLPROF_aggregate() API on this database and
      try again.<br />
    </div>

    <div
      id="database-file-not-found-exception"
      class="alert alert-danger alignLeft"
      style="display: none"
    >
      <strong>Oh no!</strong> The DLProf database cannot be found.
      <br />
      <br />
      <u>Filename:</u> <span id="dbFileName"></span> <br />
      <u>Action:</u> Restart the DLProf server pointing to a database that
      exists.
      <br />
    </div>

    <div
      id="database-version-not-found-exception"
      class="alert alert-danger alignLeft"
      style="display: none"
    >
      <strong>Oh no!</strong> An older, unsupported version of the database was
      found.
      <br />
      <br />
      <u>What does this mean?</u> This viewer cannot display any information.<br />
      <u>What can I do?</u> Upgrade to the most recent version of DLProf and
      reprofile.<br />
    </div>

    <div
      id="database-version-too-new-exception"
      class="alert alert-danger alignLeft"
      style="display: none"
    >
      <strong>Oh no!</strong> A newer or un-upgraded version of the database was
      found.
      <ul>
        <li>Found version <span id="foundDbVersion"></span></li>
        <li>Expecting version <span id="expectingDbVersion"></span></li>
      </ul>
      <br />
      <u>What does this mean?</u> This viewer cannot display any information.<br />
      <u>What can I do?</u> Upgrade to the most recent version of DLProf
      Viewer.<br />
    </div>

    <div id="dlprof-wrapper" class="right-toggled left-toggled">
      <div id="right-sidebar-wrapper">
        <div class="right-sidebar-nav">
          <span id="kernelDetailsPanel" class="dlprofPropertiesPanel"></span>
        </div>
      </div>

      <!-- prettier-ignore -->
      <div id="page-content-wrapper">
      {% block content %}
      {% endblock %}
    </div>
    </div>
  </body>
</html>

<script>
  document.querySelector('.copy-btn').addEventListener('click', () => {
    window.open('https://ui.perfetto.dev/')
  })

  AppVersion = new AppVersion();
  DbVersion = new DbVersion();
  if (DbVersion.isValidDbVersion()) {
    Globals = new Globals(); // Create private namespace for globals
    ViewDroplist = new ViewDroplist();
    AggregationDroplist = new AggregationDroplist();
    DomainDroplist = new DomainDroplist();
    Navbar = new Navbar();
    $(document).ready(function () {
      loadHtml(
        '#kernelDetailsPanel',
        '{% static "dlprof/KernelDetailsPanel.html" %}'
      );

      if (Globals.getGpuCount() > 1) {
        var title =
          'Total GPU time summed across ' + Globals.getGpuCount() + ' GPUs';
        $('.gpu-time-col').attr('title', title);
      }

      $('#menu-toggle').click(function (e) {
        e.preventDefault();
        $('#dlprof-wrapper').toggleClass('right-toggled');
      });
    });
  }
</script>
